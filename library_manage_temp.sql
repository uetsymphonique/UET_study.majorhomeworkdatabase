-- MySQL Script generated by MySQL Workbench
-- Sun Dec  4 07:18:56 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema library_management
-- -----------------------------------------------------
-- This is demo version of using database in library management
-- Built by: Quang Minh Tran - 21020471 - VNU-UET
DROP SCHEMA IF EXISTS `library_management` ;

-- -----------------------------------------------------
-- Schema library_management
--
-- This is demo version of using database in library management
-- Built by: Quang Minh Tran - 21020471 - VNU-UET
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `library_management` DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ;
USE `library_management` ;

-- -----------------------------------------------------
-- Table `library_management`.`authors`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`authors` ;

CREATE TABLE IF NOT EXISTS `library_management`.`authors` (
  `author_id` INT NOT NULL AUTO_INCREMENT,
  `author_fname` VARCHAR(45) NOT NULL,
  `author_lname` VARCHAR(45) NOT NULL,
  `author_phone` VARCHAR(10) NOT NULL,
  `author_email` VARCHAR(100) NOT NULL,
  `author_address` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`author_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`publishers`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`publishers` ;

CREATE TABLE IF NOT EXISTS `library_management`.`publishers` (
  `publisher_id` INT NOT NULL AUTO_INCREMENT,
  `publisher_name` VARCHAR(45) NOT NULL,
  `publisher_phone` VARCHAR(10) NOT NULL,
  `publisher_address` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`publisher_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`books`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`books` ;

CREATE TABLE IF NOT EXISTS `library_management`.`books` (
  `book_id` INT NOT NULL AUTO_INCREMENT,
  `book_title` VARCHAR(45) NOT NULL,
  `book_description` VARCHAR(500) NOT NULL,
  `book_category` VARCHAR(45) NOT NULL,
  `book_edition` VARCHAR(45) NOT NULL,
  `book_price` INT NULL,
  `publisher_id` INT NOT NULL,
  PRIMARY KEY (`book_id`),
  CONSTRAINT `pub_book_fk`
    FOREIGN KEY (`publisher_id`)
    REFERENCES `library_management`.`publishers` (`publisher_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`writes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`writes` ;

CREATE TABLE IF NOT EXISTS `library_management`.`writes` (
  `author_id` INT NOT NULL,
  `book_id` INT NOT NULL,
  PRIMARY KEY (`author_id`, `book_id`),
  CONSTRAINT `book_wr_fk`
    FOREIGN KEY (`book_id`)
    REFERENCES `library_management`.`books` (`book_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `auth_wr_fk`
    FOREIGN KEY (`author_id`)
    REFERENCES `library_management`.`authors` (`author_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`bookCopies`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`bookCopies` ;

CREATE TABLE IF NOT EXISTS `library_management`.`bookCopies` (
  `book_id` INT NOT NULL,
  `copyNo` INT NOT NULL,
  PRIMARY KEY (`book_id`, `copyNo`),
  CONSTRAINT `book_cp_fk`
    FOREIGN KEY (`book_id`)
    REFERENCES `library_management`.`books` (`book_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`users` ;

CREATE TABLE IF NOT EXISTS `library_management`.`users` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `user_fname` VARCHAR(45) NOT NULL,
  `user_lname` VARCHAR(45) NOT NULL,
  `user_phone` VARCHAR(10) NOT NULL,
  `user_email` VARCHAR(100) NOT NULL,
  `user_address` VARCHAR(200) NOT NULL,
  `user_password` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`user_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`requests`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`requests` ;

CREATE TABLE IF NOT EXISTS `library_management`.`requests` (
  `user_id` INT NOT NULL,
  `copyNo` INT NOT NULL,
  `book_id` INT NOT NULL,
  `request_date` DATE NOT NULL,
  `request_returnDate` DATE NULL,
  PRIMARY KEY (`user_id`, `copyNo`, `book_id`),
  INDEX `book_req_fk_idx` (`book_id` ASC, `copyNo` ASC) VISIBLE,
  CONSTRAINT `user_req_fk`
    FOREIGN KEY (`user_id`)
    REFERENCES `library_management`.`users` (`user_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `copy_req_fk`
    FOREIGN KEY (`book_id` , `copyNo`)
    REFERENCES `library_management`.`bookCopies` (`book_id` , `copyNo`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`admins`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`admins` ;

CREATE TABLE IF NOT EXISTS `library_management`.`admins` (
  `admin_id` INT NOT NULL AUTO_INCREMENT,
  `admin_fname` VARCHAR(45) NOT NULL,
  `user_lname` VARCHAR(45) NOT NULL,
  `admin_phone` VARCHAR(10) NOT NULL,
  `admin_email` VARCHAR(100) NOT NULL,
  `admin_address` VARCHAR(200) NOT NULL,
  `admin_password` VARCHAR(45) NOT NULL,
  `admin_role` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`admin_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `library_management`.`issues`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `library_management`.`issues` ;

CREATE TABLE IF NOT EXISTS `library_management`.`issues` (
  `issue_id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT NULL,
  `admin_id` INT NULL,
  `issue_body` VARCHAR(3000) NOT NULL,
  `issue_repDate` DATE NOT NULL,
  `issue_ansDate` DATE NULL,
  `issue_answer` VARCHAR(3000) NULL,
  PRIMARY KEY (`issue_id`),
  CONSTRAINT `issue_user_fk`
    FOREIGN KEY (`user_id`)
    REFERENCES `library_management`.`users` (`user_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `issue_admin_fk`
    FOREIGN KEY (`admin_id`)
    REFERENCES `library_management`.`admins` (`admin_id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `library_management`.`authors`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`authors` (`author_id`, `author_fname`, `author_lname`, `author_phone`, `author_email`, `author_address`) VALUES (100001, 'Nguyễn', 'Trường Thành', '0912334563', 'thanhnt0209@gmail.com', 'Cầu Giấy, Hà Nội');
INSERT INTO `library_management`.`authors` (`author_id`, `author_fname`, `author_lname`, `author_phone`, `author_email`, `author_address`) VALUES (100002, 'Nguyễn', 'Đức Lộc', '0765123555', 'locnguyen@gmail.com', 'Cổ Nhuế, Hà Nội');
INSERT INTO `library_management`.`authors` (`author_id`, `author_fname`, `author_lname`, `author_phone`, `author_email`, `author_address`) VALUES (100003, 'Cao ', 'Tiến Thắng', '0123444678', 'cao.hl.thang@gmail.com', 'Cầu Giấy, Hà Nội');

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`publishers`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`publishers` (`publisher_id`, `publisher_name`, `publisher_phone`, `publisher_address`) VALUES (200001, 'NXB Giáo dục', '0224356190', 'Xuân Thuỷ, Hà Nội');
INSERT INTO `library_management`.`publishers` (`publisher_id`, `publisher_name`, `publisher_phone`, `publisher_address`) VALUES (200002, 'NXB ĐHQGHN', '0224122090', 'Phạm Văn Đồng, Hà Nội');
INSERT INTO `library_management`.`publishers` (`publisher_id`, `publisher_name`, `publisher_phone`, `publisher_address`) VALUES (200003, 'NXB Thời đại', '0123000456', 'Cầu Giấy, Hà Nội');

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`books`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`books` (`book_id`, `book_title`, `book_description`, `book_category`, `book_edition`, `book_price`, `publisher_id`) VALUES (300001, 'Giải tích 1', 'sách rất là khó', 'Toán', '3rd', 50000, 200001);
INSERT INTO `library_management`.`books` (`book_id`, `book_title`, `book_description`, `book_category`, `book_edition`, `book_price`, `publisher_id`) VALUES (300002, 'Toán rời rạc', 'sách này về toán rời rạc', 'Toán', '12th', 30000, 200001);
INSERT INTO `library_management`.`books` (`book_id`, `book_title`, `book_description`, `book_category`, `book_edition`, `book_price`, `publisher_id`) VALUES (300003, 'Nhập môn lập trình', 'sách này về nhập môn lập trình', 'Lập trình', '10th', 40000, 200002);

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`bookCopies`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`bookCopies` (`book_id`, `copyNo`) VALUES (300001, 1);
INSERT INTO `library_management`.`bookCopies` (`book_id`, `copyNo`) VALUES (300001, 2);
INSERT INTO `library_management`.`bookCopies` (`book_id`, `copyNo`) VALUES (300003, 1);
INSERT INTO `library_management`.`bookCopies` (`book_id`, `copyNo`) VALUES (300002, 1);
INSERT INTO `library_management`.`bookCopies` (`book_id`, `copyNo`) VALUES (300002, 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`users`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`users` (`user_id`, `user_fname`, `user_lname`, `user_phone`, `user_email`, `user_address`, `user_password`) VALUES (500001, 'Phạm', 'Văn Thạch', '0449191456', 'thachpv@gmail.com', 'Hà Đông, Hà Nội', 'thachpv');
INSERT INTO `library_management`.`users` (`user_id`, `user_fname`, `user_lname`, `user_phone`, `user_email`, `user_address`, `user_password`) VALUES (500002, 'Nguyễn', 'Lê Linh Chi', '0988717413', 'chinguyencarat@gmail.com', 'Cổ Nhuế, Hà Nội', 'chinguyencarat');
INSERT INTO `library_management`.`users` (`user_id`, `user_fname`, `user_lname`, `user_phone`, `user_email`, `user_address`, `user_password`) VALUES (500003, 'Nguyễn ', 'Mai Anh', '0123456666', 'maianhng@gmail.com', 'Thanh Xuân, Hà Nội', 'maianhng');

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`requests`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`requests` (`user_id`, `copyNo`, `book_id`, `request_date`, `request_returnDate`) VALUES (500001, 1, 300001, '2022-11-04', '2022-10-02');
INSERT INTO `library_management`.`requests` (`user_id`, `copyNo`, `book_id`, `request_date`, `request_returnDate`) VALUES (500002, 1, 300003, '2022-12-04', NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`admins`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`admins` (`admin_id`, `admin_fname`, `user_lname`, `admin_phone`, `admin_email`, `admin_address`, `admin_password`, `admin_role`) VALUES (400001, 'Trần ', 'Quang Minh', '0949089636', 'minhtran6464.lhp@gmail.com', 'Cầu Giấy, Hà Nội', 'Tranminh.2212', 'Genaral admin');
INSERT INTO `library_management`.`admins` (`admin_id`, `admin_fname`, `user_lname`, `admin_phone`, `admin_email`, `admin_address`, `admin_password`, `admin_role`) VALUES (400002, 'Đoàn', 'Tiến Lập', '0123456789', 'doantienlap2003@gmail.com', 'Nga', 'Doanlap.1501', 'Co-general admin');
INSERT INTO `library_management`.`admins` (`admin_id`, `admin_fname`, `user_lname`, `admin_phone`, `admin_email`, `admin_address`, `admin_password`, `admin_role`) VALUES (400003, 'Đào', 'Thị Minh Hoà', '0123567891', 'minhhoand@gmail.com', 'Đống Đa,Hà Nội', 'Minhhoa.0610', 'Staff');

COMMIT;


-- -----------------------------------------------------
-- Data for table `library_management`.`issues`
-- -----------------------------------------------------
START TRANSACTION;
USE `library_management`;
INSERT INTO `library_management`.`issues` (`issue_id`, `user_id`, `admin_id`, `issue_body`, `issue_repDate`, `issue_ansDate`, `issue_answer`) VALUES (600001, 500001, 400001, 'Quạt không bật được', '2021-10-01', '2021-10-02', 'Quạt đã được sửa chữa');
INSERT INTO `library_management`.`issues` (`issue_id`, `user_id`, `admin_id`, `issue_body`, `issue_repDate`, `issue_ansDate`, `issue_answer`) VALUES (600002, 500002, 400003, 'Điện đã hỏng', '2021-11-02', '2021-11-04', 'Đèn đã được sửa chữa');
INSERT INTO `library_management`.`issues` (`issue_id`, `user_id`, `admin_id`, `issue_body`, `issue_repDate`, `issue_ansDate`, `issue_answer`) VALUES (600003, NULL, NULL, 'Giá sách lung lay', '2021-12-04', NULL, NULL);

COMMIT;

